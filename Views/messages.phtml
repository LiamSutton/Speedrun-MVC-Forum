<?php require_once ("template/header.phtml"); ?>

<div class="container">
  <div class="container">
    <ul id="msg" class="list-group">
    <ul>
  </div>
</div>
<script>
function createLst() {
        const id = "<?php echo $_SESSION['id'] ?>";
        const lst = document.getElementById('msg');
    // Make a call to loadInbox.php and retrieve a list of "conversations" ordered by Newest -> Oldest.
    fetch(`getConversations.php?id=${id}`).then((result) => {
        return result.text()
    }).then((data) => {
        console.log(data)
        let res = JSON.parse(data);
        lst.innerHTML = "";
        res.forEach(conversation => lst.append(new Conversation(conversation.id, conversation.username, conversation.fullname).build()))
    }).catch((error) => {
        console.log(error)
    })

    setTimeout(createLst, 5000);
}
   
    class Conversation {
      constructor(id, author, name) {
        this.id = id;
        this.author = author
        this.name = name
      }

      build() {
        let list = document.createElement("li");
        let div = document.createElement("div");
        let name = document.createElement("a");
        let fullname = document.createElement("p");
        fullname.innerHTML = this.name;
        name.innerHTML = this.author;
        list.className = "list-group-item list-element col-sm-12";
        name.className = "list-group-item-heading text-center";
        name.href = `conversation.php?id=${this.id}`
        list.append(div);
        div.append(fullname);
        div.append(name);

        return list
      }
    }

window.addEventListener("load", createLst);
</script>
<?php require_once ("template/footer.phtml"); ?>
  
